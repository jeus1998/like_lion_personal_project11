<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>로그인</title>
</head>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<body>
<h2>로그인</h2>
<!-- 아이디와 비밀번호를 입력하는 input 요소 -->
<label for="Id">아이디:</label>
<input type="text" id="Id" required autocomplete="username"><br>

<label for="Pw">비밀번호:</label>
<input type="password" id="Pw" required autocomplete="current-password"><br>

<!-- 로그인 버튼 -->
<button id="login">로그인</button>
<button onclick="goToMainPage()">메인 페이지로</button>

<!-- 스크립트를 통해 토큰 저장 및 로그인 처리 -->
<script>
  // 로그인 버튼을 클릭 시 로그인 함수 실행
  document.getElementById("login").addEventListener("click", login);
  function goToMainPage() {
    window.location.href = "/users/main";
  }
  // 로그인 함수
  function login() {
    const Id = document.getElementById("Id").value;
    const Pw = document.getElementById("Pw").value;

    // 서버로 아이디와 비밀번호를 전송하여 로그인 처리
    fetch("/users/login?username=id&password=pw".replace("id", Id).replace("pw", Pw))
            .then((response) => {
              if (response.ok) {
                return response.json();
              } else {
                throw new Error("오류 발생");
              }
            })
            .then((body) => {
              const token = body.token; // 토큰 추출
              console.log(`Token: ${token}`);
              // 토큰을 localStorage에 저장
              localStorage.setItem("token", token);
              let tokencheck = localStorage.getItem("token")
              console.log(`TokenCheck: ${tokencheck}`);
              console.log("토큰이 localStorage에 저장되었습니다.");
              alert("로그인 성공!");
              // 로그인 성공 시 메인으로 리다이렉트
              window.location.href = "/users/main";
            })
            .catch((error) => {
              console.error("오류 발생: ", error);
              alert("로그인 실패: " + error.message);
            });
  }
</script>


<!-- 회원가입 페이지로 넘어가는 버튼 -->
<form action="/users/register" method="get">
  <input type="submit" value="회원가입">
</form>

</body>
</html>
